---
phase: planning
title: Планирование проекта и разбивка задач
description: Разбивка работы на выполнимые задачи и оценка сроков
---

# Планирование проекта и разбивка задач

## Вехи
**Каковы основные контрольные точки?**

- [ ] Веха 1: Воспроизведение проблемы и покрытие тестами.
- [ ] Веха 2: Исправление логики построения запроса (`buildTsQuery`).
- [ ] Веха 3: Верификация исправления и регрессионное тестирование.

## Разбивка задач
**Какую конкретно работу нужно сделать?**

### Фаза 1: Анализ и Тесты
- [x] Задача 1.1: Создать модульный тест для `buildTsQuery`, воспроизводящий падение на символах `)`, `(`, `&` и пустых запросах после очистки.
- [x] Задача 1.2: Создать компонентный тест (или использовать существующий) для проверки поведения UI при вводе спецсимволов.

### Фаза 2: Реализация
- [x] Задача 2.1: Обновить `buildTsQuery` в `core/utils/search.ts`:
    - Обработка пустых строк после очистки (не выбрасывать ошибку, возвращать null или пустой запрос).
    - Улучшение регулярных выражений для сохранения полезных символов, если это возможно, или безопасного их удаления.
- [x] Задача 2.2: Обновить `SearchService` для обработки случая, когда `buildTsQuery` возвращает пустой результат (не делать запрос к БД или делать запрос с пустым условием).

### Фаза 3: Интеграция и Полировка
- [x] Задача 3.1: Проверить работу поиска в UI с различными "сложными" запросами (`C++`, `function()`, `test & demo`).
- [x] Задача 3.2: Убедиться, что нет регрессии для обычных текстовых запросов.

## Зависимости
**Что должно произойти и в каком порядке?**

- Задача 2.1 блокирует 2.2.
- Задачи фазы 1 желательны перед фазой 2 для TDD.

## Риски и смягчение
**Что может пойти не так?**

- **Риск**: Postgres `to_tsquery` очень строг к синтаксису.
- **Смягчение**: Тщательное тестирование различных комбинаций символов. Если `to_tsquery` слишком хрупок, рассмотреть переход на `websearch_to_tsquery` в будущем (требует миграции БД).

