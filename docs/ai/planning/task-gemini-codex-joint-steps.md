# План: выполнение «Совместных шагов» (Gemini & Codex)

Цель: довести текущий фронтенд до договорённой архитектуры SPA с единым Supabase‑клиентом, декомпозицией страниц, санитизацией/поиском, подготовкой к RN и чинкой документации.

## Объём и ориентиры
- Источник требований: `docs/gemini-codex-architecture-review.md`, блок «Совместные шаги».
- Ограничения: SPA (`output: 'export'`), только клиентский доступ к Supabase, без SSR/server actions.
- Результат: обновлённый код (контейнеры/хуки/сервисы), очищенная документация, готовые адаптеры для RN.

## План работ
1) Единый Supabase клиент и сервисный слой  
   - Убрать точечные `createClient` в ENEX/поиске; прокидывать провайдер/сервисы.  
   - Проверить/упростить `lib/services/*` и гарантировать единый инстанс клиента.

2) Декомпозиция `app/page.tsx`  
   - Вынести оболочки/панели (AuthShell/NotesShell/ListPane/EditorPane) и минимизировать логику страницы.  
   - Оставить состояние/операции в контроллере/хуках; обеспечить совместимость с SPA-export.

3) Поиск и санитизация (консолидация)  
   - Использовать общий сервис поиска (FTS → ILIKE) и общий компонент вывода результатов.  
   - Убедиться, что вывод и импорт проходят через единый sanitization pipeline.

4) Подготовка к React Native  
   - Ввести/подключить адаптеры для browser API (window/localStorage/prompt).  
   - Убрать прямые обращения к браузеру в контроллерах/редакторе; обозначить RN-совместимые места.

5) Документация  
   - Восстановить читаемость `README.md` и `docs/ARCHITECTURE.md` (кодировка).  
   - Синхронизировать описание архитектуры с новой структурой (SPA, провайдеры, сервисы, контейнеры).

6) Проверки  
   - Запустить доступные локальные проверки/линты (по возможности).  
   - Кратко зафиксировать выполненное и оставшиеся риски.

## Ожидаемые артефакты
- Обновлённые файлы: `app/page.tsx`, новые контейнеры/панели, контроллер/хуки, сервисы Supabase/поиска/ENEX.  
- Адаптеры браузерных API, интегрированные в контроллер/редактор.  
- Исправленные `README.md`, `docs/ARCHITECTURE.md`.  
- Краткий итог в ответе (и/или обновление релевантных docs в `docs/ai/` при изменении решений).
