---
phase: requirements
title: Требования и понимание проблемы
description: Уточнение области проблемы, сбор требований и определение критериев успеха
---

# Требования и понимание проблемы

## Постановка проблемы
**Какую проблему мы решаем?**

Текущая функциональность поиска в EverFreeNote работает некорректно, если поисковый запрос содержит определенные специальные символы (например, `)`). Это приводит к тому, что результаты не возвращаются, даже если есть подходящие заметки, или возникает ошибка. Кроме того, нам нужно убедиться, что механизм поиска устойчив к инъекциям и другим уязвимостям безопасности, позволяя пользователям искать любые комбинации символов, которые могут встретиться в их заметках (включая фрагменты кода, математические формулы и т.д.).

## Цели и задачи
**Чего мы хотим достичь?**

- **Основная цель:** Обеспечить корректный возврат результатов поиска независимо от символов, используемых в поисковом запросе.
- **Вторичная цель:** Поддерживать или улучшать безопасность функции поиска от атак типа инъекций.
- **Вторичная цель:** Обеспечить предсказуемый пользовательский опыт, где "что вы печатаете, то и ищете".

## Пользовательские истории и сценарии использования
**Как пользователи будут взаимодействовать с решением?**

- Как **разработчик**, я хочу искать фрагменты кода, такие как `function()` или `array[i]`, чтобы находить свои технические заметки.
- Как **студент**, я хочу искать математические формулы, такие как `(a+b)`, чтобы находить свои учебные заметки.
- Как **пользователь**, я хочу иметь возможность вводить любой текст в строку поиска без сбоев приложения или неожиданного получения пустого списка.

## Критерии успеха
**Как мы узнаем, что закончили?**

- Поисковые запросы, содержащие специальные символы, такие как `()`, `[]`, `{}`, `*`, `+`, `-`, `&`, `|`, `!`, `:`, `<` , `>`, `,`,возвращают релевантные результаты или корректно обрабатываются без ошибок.
- Поисковые запросы со смешанными буквенно-цифровыми и специальными символами работают корректно.
- Невозможны SQL-инъекции или инъекции синтаксиса поиска.
- Модульные тесты покрывают различные сценарии со специальными символами.
- End-to-end тесты проверяют функциональность поиска со специальными символами.

## Ограничения и допущения
**В каких рамках нам нужно работать?**

- Должно работать с существующим бэкендом Supabase и PostgreSQL Full Text Search (FTS).
- Не должно существенно ухудшать производительность поиска.
- Мы предполагаем, что проблема кроется в текущей функции RPC `web_search` или в построении запроса на стороне клиента (`buildTsQuery`).

## Вопросы и открытые пункты
**Что нам еще нужно прояснить?**

- Есть ли какие-то символы, которые *должны* быть зарезервированы для операторов поиска (например, `&` для И, `|` для ИЛИ), доступных пользователю? Или мы должны рассматривать весь пользовательский ввод как буквальный текст?
  - *Допущение:* Мы должны рассматривать пользовательский ввод как буквальный текст, насколько это возможно, или обеспечивать безопасное экранирование. На данный момент мы стремимся к "умной" обработке, где мы санируем ввод для движка, но пытаемся соответствовать намерениям пользователя.
