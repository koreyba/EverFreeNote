---
phase: requirements
title: Requirements & Problem Understanding
description: Clarify the problem space, gather requirements, and define success criteria
---

# Requirements & Problem Understanding

## Problem Statement
**What problem are we solving?**

- Пользователи Evernote хотят мигрировать свои заметки в EverFreeNote, но нет способа импортировать данные
- Формат экспорта Evernote (.enex) не поддерживается приложением
- Ручное копирование заметок занимает много времени и теряется форматирование
- Затронуты все пользователи, которые хотят перейти с Evernote на EverFreeNote
- Текущая ситуация: пользователи вынуждены вручную пересоздавать заметки, теряя метаданные (даты, теги)

## Goals & Objectives
**What do we want to achieve?**

**Primary goals:**
- Добавить возможность импорта одного .enex файла с одной или несколькими заметками
- Добавить возможность массового импорта множественных .enex файлов
- Сохранить форматирование текста (bold, italic, headings, lists, links)
- Сохранить метаданные (title, tags, created/updated dates)
- Добавить поддержку изображений в редакторе и импорте

**Secondary goals:**
- Показывать прогресс импорта для больших файлов
- Обрабатывать дубликаты с маркировкой [duplicate]
- Graceful degradation для неподдерживаемых элементов

**Non-goals:**
- Поддержка файловых вложений (attachments) - только изображения
- Preview перед импортом
- Синхронизация с Evernote API
- Экспорт обратно в .enex формат (пока)

## User Stories & Use Cases
**How will users interact with the solution?**

**US-1:** Как пользователь Evernote, я хочу импортировать одну заметку из .enex файла, чтобы перенести важную информацию в EverFreeNote

**US-2:** Как пользователь, я хочу импортировать множество заметок одновременно, чтобы быстро мигрировать всю библиотеку из Evernote

**US-3:** Как пользователь, я хочу видеть прогресс импорта, чтобы понимать сколько заметок обработано и сколько осталось

**US-4:** Как пользователь, я хочу чтобы форматирование (жирный, курсив, списки, заголовки) сохранилось, чтобы заметки выглядели как в Evernote

**US-5:** Как пользователь, я хочу чтобы теги импортировались автоматически, чтобы сохранить организацию заметок

**US-6:** Как пользователь, я хочу чтобы изображения в заметках импортировались, чтобы не потерять визуальный контент

**US-7:** Как пользователь, я хочу чтобы оригинальные даты создания/обновления сохранились, чтобы видеть историю заметок

**US-8:** Как пользователь, я хочу видеть какие элементы не поддерживаются перед импортом, чтобы понимать что может быть потеряно

**Key workflows:**
1. **Single file import:**
   - Нажать кнопку "Import from Evernote"
   - Выбрать .enex файл
   - Дождаться завершения импорта
   - Увидеть импортированные заметки в списке

2. **Batch import:**
   - Нажать кнопку "Import from Evernote"
   - Выбрать множество .enex файлов
   - Видеть прогресс импорта (X из Y файлов)
   - Увидеть все импортированные заметки

3. **Viewing imported note:**
   - Открыть импортированную заметку
   - Увидеть сохраненное форматирование
   - Увидеть изображения (если были)
   - Увидеть теги
   - Увидеть оригинальные даты

**Edge cases:**
- Пустой .enex файл
- Поврежденный XML в .enex
- .enex с неподдерживаемыми элементами (tables, attachments, code blocks)
- Очень большие файлы (>100 заметок)
- Дубликаты заметок (по title)
- Заметки без заголовка
- Изображения в base64 больших размеров
- Специальные символы в заголовках и тегах

## Success Criteria
**How will we know when we're done?**

**Measurable outcomes:**
- ✅ Пользователь может импортировать .enex файл с одной заметкой
- ✅ Пользователь может импортировать .enex файл с множеством заметок
- ✅ Пользователь может импортировать множество .enex файлов одновременно
- ✅ Форматирование текста сохраняется (bold, italic, underline, headings, lists, links)
- ✅ Изображения импортируются и отображаются в редакторе
- ✅ Теги импортируются и отображаются
- ✅ Оригинальные даты created/updated сохраняются
- ✅ Дубликаты помечаются как [duplicate] в заголовке
- ✅ Неподдерживаемые элементы заменяются на placeholder текст
- ✅ Показывается прогресс импорта для batch операций

**Acceptance criteria:**
- Пользователь видит кнопку "Import from Evernote" в UI
- При клике открывается file picker с фильтром .enex
- Можно выбрать один или несколько файлов
- Во время импорта показывается прогресс
- После импорта заметки появляются в списке
- Форматирование в редакторе соответствует оригиналу
- Изображения отображаются корректно
- При ошибке показывается понятное сообщение
- Импорт не падает на неподдерживаемых элементах

**Performance benchmarks:**
- Импорт 1 заметки: < 1 секунда
- Импорт 10 заметок: < 5 секунд
- Импорт 100 заметок: < 30 секунд
- UI не блокируется во время импорта

## Constraints & Assumptions
**What limitations do we need to work within?**

**Technical constraints:**
- Браузерные ограничения на размер файлов (обычно до 100MB)
- XML parsing в браузере (DOMParser API)
- Base64 декодирование для изображений
- Supabase storage для изображений
- Tiptap editor capabilities

**Business constraints:**
- Минимальное время на реализацию
- Не должны сломаться существующие функции
- Поэтапная реализация допустима

**Assumptions:**
- .enex файлы валидны и соответствуют Evernote формату
- Пользователи имеют доступ к экспорту из Evernote
- Изображения в .enex в base64 формате
- HTML в .enex совместим с Tiptap
- У пользователя есть права на создание заметок в Supabase

## Questions & Open Items
**What do we still need to clarify?**

**Resolved:**
- ✅ Поддержка файлов? → Нет, только изображения
- ✅ Оригинальные даты? → Да, сохранять
- ✅ Дубликаты? → Помечать [duplicate] в заголовке
- ✅ Preview? → Нет, не нужен
- ✅ Неподдерживаемые элементы? → Заменять на placeholder текст
- ✅ Поддержка изображений? → Да, обязательно
- ✅ Поэтапная реализация? → Да, допустима

**Open items:**
- Какой placeholder текст использовать для неподдерживаемых элементов? → Предложение: `[Unsupported content: {type}]`
- Нужно ли логировать статистику импорта (сколько успешно, сколько с ошибками)?
- Максимальный размер изображения для импорта?
- Нужна ли возможность отменить импорт в процессе?
- Где хранить импортированные изображения в Supabase? (bucket name, path structure)

