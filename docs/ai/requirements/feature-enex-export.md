---
phase: requirements
title: Requirements & Problem Understanding
description: Clarify the problem space, gather requirements, and define success criteria
---

# Requirements: Evernote Export (.enex)

## Problem Statement
**What problem are we solving?**

Пользователи хотят экспортировать свои заметки из EverFreeNote в формат .enex для:
- Резервного копирования данных
- Миграции в другие системы, поддерживающие .enex
- Совместимости с Evernote и другими приложениями

**Who is affected by this problem?**
- Пользователи, которые хотят иметь резервную копию своих заметок
- Пользователи, планирующие миграцию в другие системы
- Пользователи, которым нужна совместимость с Evernote

**What is the current situation/workaround?**
- В настоящее время нет возможности экспорта заметок
- Пользователи не могут получить свои данные в стандартном формате
- Пользователи не могут создать резервную копию своих заметок
- Нет способа мигрировать данные в другие системы, поддерживающие .enex

## Goals & Objectives
**What do we want to achieve?**

- Primary goals
  - Экспорт выбранных заметок пользователя в формат .enex (с возможностью выбрать все заметки)
  - Удобный интерфейс выбора заметок с карточками и чекбоксами
  - Сохранение форматирования, тегов, дат создания/обновления
  - Включение изображений в экспортируемый файл
  - Генерация валидного XML файла, совместимого с Evernote

- Secondary goals
  - Индикация прогресса экспорта
  - Обработка ошибок при экспорте
  - Оптимизация для большого количества заметок

- Non-goals (what's explicitly out of scope)
  - Фильтрация по тегам/датам (на первом этапе)
  - Экспорт в другие форматы (только .enex)

## User Stories & Use Cases
**How will users interact with the solution?**

- Как пользователь, я хочу выбрать заметки для экспорта через удобный интерфейс с карточками заметок
- Как пользователь, я хочу иметь возможность выбрать все заметки одной кнопкой
- Как пользователь, я хочу экспортировать выбранные заметки в .enex файл, чтобы иметь резервную копию
- Как пользователь, я хочу, чтобы экспортированные заметки сохраняли форматирование и изображения
- Как пользователь, я хочу видеть прогресс экспорта при большом количестве заметок
- Как пользователь, я хочу получить уведомление об успешном завершении экспорта
- Как пользователь, я хочу получить предупреждение, если некоторые изображения не удалось экспортировать
- Как пользователь, я хочу видеть понятное имя файла экспорта с датой и временем

**Key workflows and scenarios:**
1. Пользователь нажимает кнопку "Экспорт в .enex" (под кнопкой импорта)
2. Открывается диалог выбора заметок с карточками (как в левом баре) и чекбоксами
3. Пользователь выбирает заметки (или нажимает "Выбрать все")
4. Пользователь подтверждает выбор и запускает экспорт
5. Система получает выбранные заметки из БД
6. Для каждой заметки извлекаются изображения из HTML
7. Изображения скачиваются из Supabase Storage и конвертируются в base64 (проблемные изображения пропускаются)
8. Формируется XML структура .enex файла
9. Файл создается с именем `everfreenote-export-YYYYMMDD-HHMMSS.enex` (дата/время экспорта)
10. Файл предлагается для скачивания через браузер
11. Пользователь получает уведомление об успешном завершении (или предупреждение о пропущенных изображениях)

**Edge cases to consider:**
- Заметки без изображений
- Заметки с большим количеством изображений (50+ на заметку)
- Ошибки при скачивании изображений из Storage (graceful degradation)
- Очень большие файлы экспорта (>100MB)
- Заметки с пустым содержимым
- Заметки без тегов
- Пустой список заметок (пользователь не выбрал ни одной)
- Попытка экспорта без выбора заметок (валидация)
- Очень большое количество заметок (1000+)
- Заметки со специальными символами в названии/контенте
- Заметки с очень длинными названиями
- У пользователя вообще нет заметок (пустой список в диалоге выбора)
- Прерывание экспорта пользователем (закрытие вкладки/браузера во время экспорта)
- Сетевые таймауты при скачивании изображений

## Success Criteria
**How will we know when we're done?**

- Measurable outcomes
  - ✅ Экспорт выбранных заметок пользователя в .enex формат (с возможностью выбрать все)
  - ✅ Валидный XML файл, открывающийся в Evernote
  - ✅ Сохранение форматирования (HTML контент)
  - ✅ Сохранение тегов
  - ✅ Сохранение дат создания и обновления
  - ✅ Изображения включены в файл как base64 ресурсы
  - ✅ Пользователь может выбрать заметки через UI с карточками и чекбоксами
  - ✅ Кнопка "Выбрать все" работает корректно

- Acceptance criteria
  - Экспортированный файл можно импортировать обратно в EverFreeNote
  - Экспортированный файл можно открыть в Evernote
  - Все изображения отображаются корректно после импорта (кроме пропущенных при ошибках)
  - Теги сохраняются
  - Даты создания/обновления сохраняются
  - XML файл валиден и соответствует DTD схеме Evernote
  - Пользователь получает предупреждение о пропущенных изображениях (если были ошибки)
  - Диалог выбора заметок работает корректно (выбор, снятие выбора, "Выбрать все")
  - Файл экспорта имеет понятное имя с датой/временем экспорта
  - Если у пользователя нет заметок, диалог показывает пустой список с соответствующим сообщением
  - Кнопка экспорта неактивна, если не выбрано ни одной заметки

- Performance benchmarks (if applicable)
  - Экспорт 100 заметок с изображениями должен завершиться за <30 секунд
  - Экспорт 1000 заметок без изображений должен завершиться за <10 секунд

## Constraints & Assumptions
**What limitations do we need to work within?**

- Technical constraints
  - Браузерные ограничения на размер файла (зависит от браузера)
  - Ограничения памяти при обработке большого количества изображений
  - Необходимость скачивания изображений из Supabase Storage

- Business constraints
  - Экспорт должен работать только для аутентифицированных пользователей
  - Экспорт только собственных заметок пользователя (RLS)

- Time/budget constraints
  - Реализация должна быть эффективной и не требовать серверной части

- Assumptions we're making
  - Все изображения доступны через публичные URL из Supabase Storage
  - HTML контент заметок совместим с форматом Evernote ENML
  - Пользователи имеют стабильное интернет-соединение для скачивания изображений
  - При ошибках скачивания изображений экспорт продолжается (graceful degradation)
  - Проблемные изображения пропускаются с логированием, но не прерывают экспорт
  - Браузер поддерживает Blob API и File API для скачивания файлов
  - Пользователь не будет прерывать экспорт (но система должна корректно обрабатывать такие случаи)

## Questions & Open Items
**What do we still need to clarify?**

- Unresolved questions
  - Все основные вопросы уточнены в процессе обсуждения

- Items requiring stakeholder input
  - Требования к производительности для очень больших наборов данных (>5000 заметок)
  - Стратегия обработки очень больших файлов экспорта (>200MB)

- Research needed
  - Максимальный размер .enex файла, поддерживаемый Evernote (для валидации)
  - Оптимальная стратегия обработки большого количества изображений (batch size, timeout)
  - Ограничения браузеров на размер Blob файлов для скачивания
