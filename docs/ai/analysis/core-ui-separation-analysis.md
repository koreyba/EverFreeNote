# –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Core/UI

## –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

**Core —á–∏—Å—Ç –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º** ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç UI –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ. –û–¥–Ω–∞–∫–æ –µ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ **–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** –º–µ–∂–¥—É –ø–∞–ø–∫–∞–º–∏ `lib/` –∏ `core/`, –∞ —Ç–∞–∫–∂–µ **–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ UI-—Å–ª–æ–µ**, –∫–æ—Ç–æ—Ä—É—é —Å–ª–µ–¥—É–µ—Ç –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ core –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.

---

## 1. –ê–Ω–∞–ª–∏–∑ —Å–ª–æ—è Core

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: `core/`

```
core/
‚îú‚îÄ‚îÄ index.ts              # –†–µ—ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts           # AuthService
‚îÇ   ‚îú‚îÄ‚îÄ notes.ts          # NoteService
‚îÇ   ‚îú‚îÄ‚îÄ search.ts         # SearchService (FTS)
‚îÇ   ‚îî‚îÄ‚îÄ sanitizer.ts      # –†–µ—ç–∫—Å–ø–æ—Ä—Ç –∏–∑ lib/
‚îú‚îÄ‚îÄ adapters/
‚îÇ   ‚îú‚îÄ‚îÄ storage.ts        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å StorageAdapter
‚îÇ   ‚îú‚îÄ‚îÄ navigation.ts     # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å NavigationAdapter
‚îÇ   ‚îú‚îÄ‚îÄ oauth.ts          # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å OAuthAdapter
‚îÇ   ‚îú‚îÄ‚îÄ config.ts         # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ConfigAdapter
‚îÇ   ‚îî‚îÄ‚îÄ supabaseClient.ts # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å getSupabaseClient
‚îî‚îÄ‚îÄ utils/
    ‚îî‚îÄ‚îÄ search.ts         # –£—Ç–∏–ª–∏—Ç–∞ buildSearchQuery
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Core

| –§–∞–π–ª | –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –°—Ç–∞—Ç—É—Å |
|------|-------------|--------|
| `core/services/auth.ts` | `@supabase/supabase-js` | ‚úÖ –ß–∏—Å—Ç–æ |
| `core/services/notes.ts` | `@supabase/supabase-js`, `@/supabase/types` | ‚úÖ –ß–∏—Å—Ç–æ |
| `core/services/search.ts` | `@supabase/supabase-js` | ‚úÖ –ß–∏—Å—Ç–æ |
| `core/services/sanitizer.ts` | `@/lib/services/sanitizer` | ‚ö†Ô∏è –†–µ—ç–∫—Å–ø–æ—Ä—Ç |
| `core/adapters/*` | –ß–∏—Å—Ç—ã–µ TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã | ‚úÖ –ß–∏—Å—Ç–æ |
| `core/utils/search.ts` | –ë–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π | ‚úÖ –ß–∏—Å—Ç–æ |

**–í—ã–≤–æ–¥: Core –ù–ï –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç React/UI.** –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –ª—é–±–æ–º TypeScript-–æ–∫—Ä—É–∂–µ–Ω–∏–∏.

---

## 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: lib/ vs core/

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã

| lib/ | core/ | –†–∞–∑–ª–∏—á–∏–µ |
|------|-------|----------|
| `lib/services/auth.ts` | `core/services/auth.ts` | **–ò–¥–µ–Ω—Ç–∏—á–Ω—ã** (—Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ) |
| `lib/services/notes.ts` | `core/services/notes.ts` | –í lib –µ—Å—Ç—å –º–µ—Ç–æ–¥ `getNotesByIds` |
| `lib/services/sanitizer.ts` | `core/services/sanitizer.ts` | **core —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç lib** |

### –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

| –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç lib/ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç core/ |
|-------------|-----------------|------------------|
| `ui/web/hooks/useNotesQuery.ts` | - | `@core/services/notes`, `@core/services/search` |
| `ui/web/hooks/useNotesMutations.ts` | - | `@core/services/notes` |
| `ui/web/hooks/useNoteAppController.ts` | - | `@core/services/auth` |
| `lib/enex/export-service.ts` | `../services/notes` | - |
| `cypress/component/...ExportButton.cy.tsx` | `@/lib/services/notes` | - |
| `cypress/component/...ExportSelectionDialog.cy.tsx` | `@/lib/services/notes` | - |

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–£–¥–∞–ª–∏—Ç—å `lib/services/auth.ts`** ‚Äî –¥—É–±–ª–∏–∫–∞—Ç core
2. **–û–±—ä–µ–¥–∏–Ω–∏—Ç—å `lib/services/notes.ts` —Å `core/services/notes.ts`** ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–π –º–µ—Ç–æ–¥ `getNotesByIds`
3. **–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ `lib/services/sanitizer.ts` –≤ `core/services/sanitizer.ts`** ‚Äî —É–±—Ä–∞—Ç—å —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç
4. **–û–±–Ω–æ–≤–∏—Ç—å ENEX —ç–∫—Å–ø–æ—Ä—Ç –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ core** ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å –∏–º–ø–æ—Ä—Ç –≤ `lib/enex/export-service.ts`

---

## 3. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ UI-—Å–ª–æ–µ

### –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –≤ `ui/web/hooks/useNoteAppController.ts`

–°–ª–µ–¥—É—é—â—É—é –ª–æ–≥–∏–∫—É —Å–ª–µ–¥—É–µ—Ç –≤—ã–Ω–µ—Å—Ç–∏ –≤ core-—Å–µ—Ä–≤–∏—Å—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö:

#### 3.1 –õ–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ (—Å—Ç—Ä–æ–∫–∏ 287-324)

```typescript
// –°–µ–π—á–∞—Å –≤ UI —Ö—É–∫–µ - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ core/services/account.ts
const handleDeleteAccount = async () => {
  // –í—ã–∑–æ–≤ Supabase edge function
  // –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å `core/services/account.ts` —Å `AccountService.deleteAccount()`

#### 3.2 –õ–æ–≥–∏–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ FTS (—Å—Ç—Ä–æ–∫–∏ 79-113)

```typescript
// –õ–æ–≥–∏–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ FTS
const [ftsOffset, setFtsOffset] = useState(0)
const [ftsAccumulatedResults, setFtsAccumulatedResults] = useState<SearchResult[]>([])
// ... —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å `core/services/fts-pagination.ts` —Å:
- –ö–ª–∞—Å—Å `FtsPaginationService`
- –ß–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è `accumulateResults(prev, next, offset)`
- –ß–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è `hasMore(pageSize, limit)`

#### 3.3 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤—ã–±–æ—Ä–∞ (—Å—Ç—Ä–æ–∫–∏ 439-502)

```typescript
// –†–µ–∂–∏–º –≤—ã–±–æ—Ä–∞, –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
const enterSelectionMode = () => {...}
const toggleNoteSelection = (noteId) => {...}
const selectAllVisible = () => {...}
const deleteSelectedNotes = async () => {...}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å `core/services/selection.ts` —Å:
- –ö–ª–∞—Å—Å `SelectionService`
- –ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –≤—ã–±–æ—Ä–∞
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º–∞—è –ª–æ–≥–∏–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è

---

## 4. –ü–∞–ø–∫–∞ lib/: —á—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å vs –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏

### –î–æ–ª–∂–Ω–æ –æ—Å—Ç–∞—Ç—å—Å—è –≤ lib/

| –ü—É—Ç—å | –ü—Ä–∏—á–∏–Ω–∞ |
|------|---------|
| `lib/enex/*` | ENEX —ç–∫—Å–ø–æ—Ä—Ç ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ñ–∏—á–∞, –Ω–µ core |
| `lib/supabase/client.ts` | Web-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞ |
| `lib/providers/SupabaseProvider.tsx` | React-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä |
| `lib/utils.ts` | –°–æ–¥–µ—Ä–∂–∏—Ç `cn()` ‚Äî —É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è Tailwind |
| `lib/constants/typography.ts` | UI-–∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã |
| `lib/utils/normalize-html.ts` | –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤ core, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö |

### –î–æ–ª–∂–Ω–æ –ø–µ—Ä–µ–µ—Ö–∞—Ç—å –≤ core/

| –ü—É—Ç—å | –ö—É–¥–∞ | –ü—Ä–∏—á–∏–Ω–∞ |
|------|------|---------|
| `lib/services/auth.ts` | –£–î–ê–õ–ò–¢–¨ | –î—É–±–ª–∏–∫–∞—Ç |
| `lib/services/notes.ts` | –û–ë–™–ï–î–ò–ù–ò–¢–¨ | –ù–µ–¥–æ—Å—Ç–∞—é—â–∏–π –º–µ—Ç–æ–¥ |
| `lib/services/sanitizer.ts` | –ü–ï–†–ï–ù–ï–°–¢–ò | –ü–ª–∞—Ç—Ñ–æ—Ä–º–æ-–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π |
| `lib/adapters/browser.ts` | –£–î–ê–õ–ò–¢–¨ –∏–ª–∏ –û–ë–™–ï–î–ò–ù–ò–¢–¨ | –î—É–±–ª–∏—Ä—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ core |

---

## 5. –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –∞–¥–∞–ø—Ç–µ—Ä–æ–≤

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
core/adapters/           # –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îú‚îÄ‚îÄ storage.ts           # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å StorageAdapter
‚îú‚îÄ‚îÄ navigation.ts        # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å NavigationAdapter
‚îú‚îÄ‚îÄ oauth.ts             # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å OAuthAdapter
‚îú‚îÄ‚îÄ config.ts            # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ConfigAdapter
‚îî‚îÄ‚îÄ supabaseClient.ts    # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å getSupabaseClient

ui/web/adapters/         # Web-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ storage.ts           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ localStorage
‚îú‚îÄ‚îÄ navigation.ts        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Next.js router
‚îú‚îÄ‚îÄ oauth.ts             # Web OAuth —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îî‚îÄ‚îÄ supabaseClient.ts    # Browser Supabase client

ui/mobile/adapters/      # –ú–æ–±–∏–ª—å–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–∑–∞–≥–ª—É—à–∫–∏)
‚îú‚îÄ‚îÄ storage.ts           # –ü—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞
‚îú‚îÄ‚îÄ navigation.ts        # –ü—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞
‚îú‚îÄ‚îÄ oauth.ts             # –ü—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞
‚îî‚îÄ‚îÄ supabaseClient.ts    # –ü—É—Å—Ç–∞—è –∑–∞–≥–ª—É—à–∫–∞
```

**–í—ã–≤–æ–¥: –ü–∞—Ç—Ç–µ—Ä–Ω –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ.** Core –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, UI –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

### lib/adapters/browser.ts

–≠—Ç–æ—Ç —Ñ–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BrowserAdapter`, –ø–æ—Ö–æ–∂–∏–π –Ω–∞ –∞–¥–∞–ø—Ç–µ—Ä—ã core, –Ω–æ –∏–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ web-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é. **–ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å** ‚Äî —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å `core/adapters/` + `ui/web/adapters/`.

---

## 6. –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã | –í–ª–∏—è–Ω–∏–µ |
|--------|-----------|--------------|---------|
| –£–¥–∞–ª–∏—Ç—å `lib/services/auth.ts` | –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∏–µ | –£–º–µ–Ω—å—à–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É |
| –î–æ–±–∞–≤–∏—Ç—å `getNotesByIds` –≤ core | –í—ã—Å–æ–∫–∏–π | –ù–∏–∑–∫–∏–µ | –ü–æ–∑–≤–æ–ª—è–µ—Ç ENEX –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å core |
| –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ sanitizer –≤ core | –°—Ä–µ–¥–Ω–∏–π | –ù–∏–∑–∫–∏–µ | –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ |
| –í—ã–Ω–µ—Å—Ç–∏ —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ core | –í—ã—Å–æ–∫–∏–π | –°—Ä–µ–¥–Ω–∏–µ | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö |
| –í—ã–Ω–µ—Å—Ç–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—é FTS –≤ core | –°—Ä–µ–¥–Ω–∏–π | –°—Ä–µ–¥–Ω–∏–µ | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö |
| –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –≤ core | –°—Ä–µ–¥–Ω–∏–π | –°—Ä–µ–¥–Ω–∏–µ | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö |
| –£–¥–∞–ª–∏—Ç—å `lib/adapters/browser.ts` | –ù–∏–∑–∫–∏–π | –ù–∏–∑–∫–∏–µ | –û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞ |

---

## 7. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –ß—Ç–æ —Ö–æ—Ä–æ—à–æ

- Core-—Å–ª–æ–π –∏–º–µ–µ—Ç **–Ω–æ–ª—å UI-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** ‚Äî –≥–æ—Ç–æ–≤ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
- –ü–∞—Ç—Ç–µ—Ä–Ω –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –°–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç dependency injection (Supabase client)
- –¢–∏–ø—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ —á–µ—Ä–µ–∑ `@/supabase/types`

### ‚ö†Ô∏è –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

1. ~~**–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** –º–µ–∂–¥—É lib/ –∏ core/ —Å–µ—Ä–≤–∏—Å–∞–º–∏~~ ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
2. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞** –≤ UI —Ö—É–∫–∞—Ö –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–µ—Ö–∞—Ç—å –≤ core
3. ~~**–ù–µ–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã** ‚Äî —á–∞—Å—Ç—å —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lib/, —á–∞—Å—Ç—å core/~~ ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
4. ~~**ENEX —ç–∫—Å–ø–æ—Ä—Ç** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç lib/services –≤–º–µ—Å—Ç–æ core/~~ ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. ~~**–°—Ä–æ—á–Ω–æ:** –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å lib/services –≤ core/services~~ ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ
2. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ:** –í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É account/FTS/selection –≤ core
3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ:** –°–ª–µ–¥–∏—Ç—å, —á—Ç–æ–±—ã –≤—Å—è –Ω–æ–≤–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —à–ª–∞ –≤ core/

---

## 8. –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (2025-12-11)

### –£–¥–∞–ª–µ–Ω–æ
- `lib/services/auth.ts` ‚Äî –¥—É–±–ª–∏–∫–∞—Ç core
- `lib/services/notes.ts` ‚Äî –¥—É–±–ª–∏–∫–∞—Ç core (–º–µ—Ç–æ–¥ `getNotesByIds` –¥–æ–±–∞–≤–ª–µ–Ω –≤ core)
- `lib/services/sanitizer.ts` ‚Äî –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –≤ core
- `lib/adapters/browser.ts` ‚Äî –ø–µ—Ä–µ–º–µ—â—ë–Ω –≤ ui/web/adapters/
- –ü–∞–ø–∫–∏ `lib/services/` –∏ `lib/adapters/` (–ø—É—Å—Ç—ã–µ)

### –î–æ–±–∞–≤–ª–µ–Ω–æ/–æ–±–Ω–æ–≤–ª–µ–Ω–æ
- `core/services/notes.ts` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `getNotesByIds`
- `core/services/sanitizer.ts` ‚Äî –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–≤–º–µ—Å—Ç–æ —Ä–µ—ç–∫—Å–ø–æ—Ä—Ç–∞)
- `ui/web/adapters/browser.ts` ‚Äî –ø–µ—Ä–µ–Ω–µ—Å—ë–Ω –∏–∑ lib/

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
| –§–∞–π–ª | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|------|------|-------|
| `components/NoteCard.tsx` | `@/lib/services/sanitizer` | `@core/services/sanitizer` |
| `components/NoteView.tsx` | `@/lib/services/sanitizer` | `@core/services/sanitizer` |
| `components/ExportButton.tsx` | `@/lib/services/notes` | `@core/services/notes` |
| `components/ExportSelectionDialog.tsx` | `@/lib/services/notes` | `@core/services/notes` |
| `lib/enex/export-service.ts` | `../services/notes` | `@core/services/notes` |
| `components/ErrorBoundary.tsx` | `@/lib/adapters/browser` | `@ui/web/adapters/browser` |
| `components/RichTextEditor.tsx` | `@/lib/adapters/browser` | `@ui/web/adapters/browser` |
| `components/ImportButton.tsx` | `@/lib/adapters/browser` | `@ui/web/adapters/browser` |
| –¢–µ—Å—Ç—ã Cypress (8 —Ñ–∞–π–ª–æ–≤) | `@/lib/...` | `@core/...` –∏–ª–∏ `@ui/web/...` |

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ lib/
```
lib/
‚îú‚îÄ‚îÄ enex/           # ENEX —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è
‚îú‚îÄ‚îÄ supabase/       # Web Supabase –∫–ª–∏–µ–Ω—Ç ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è
‚îú‚îÄ‚îÄ providers/      # React –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è
‚îú‚îÄ‚îÄ constants/      # UI –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è
‚îú‚îÄ‚îÄ utils.ts        # cn() –¥–ª—è Tailwind ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è
‚îî‚îÄ‚îÄ utils/          # normalize-html ‚Äî –æ—Å—Ç–∞—ë—Ç—Å—è
```

---

*–°–æ–∑–¥–∞–Ω–æ: 2025-12-11*
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-12-11*
