# Аудит архитектуры мобильного приложения EverFreeNote (управленческий отчёт)

Дата: 2025-12-21

## Зачем этот документ
Вы попросили оценить, «то ли мы делаем», потому что мобильная разработка стартовала заметно тяжелее, чем веб. Этот отчёт:
- объясняет архитектуру на функциональном уровне (без технических деталей);
- показывает, какие решения были приняты и почему это могло породить сложности;
- даёт вердикт: это разумная архитектура или «страдаем фигнёй»;
- предлагает варианты, что делать дальше и какие решения требуется принять.

## Короткое резюме (для менеджера)
1) **В целом архитектура выбрана правильно**: есть отдельное «ядро» с бизнес‑логикой и отдельные пользовательские интерфейсы для web и mobile. Это снижает дублирование и ускоряет развитие продукта в долгую.

2) **Почему мобильная разработка тяжелее** — это ожидаемо: мобильная среда объективно сложнее (устройства, сеть, хранение данных, «возврат» из внешнего входа, ограничения платформ). Плюс у нас есть важное решение, которое усиливает сложность (см. ниже про редактор).

3) **Главная причина “постоянно что-то не так” — выбранный подход к редактору заметок в mobile**: мы используем внутри приложения встроенный «веб‑редактор». Это ускоряет получение функционала, но добавляет целый класс проблем: зависимость от доступности страницы редактора, особенности работы на реальном телефоне, нюансы с большими заметками и медиа.

4) **Это не “фигня”, а нормальный компромисс**, но он требует управленческого решения: готовы ли мы платить сложностью разработки и потенциальными ограничениями офлайна ради быстрого MVP, или нужно менять стратегию редактора.

## Как устроена архитектура (на уровне системы)
Архитектура построена по принципу «одна бизнес‑логика — несколько интерфейсов»:

1) **Ядро продукта (core)**  
Здесь находится то, что должно быть единым для web и mobile: правила работы с заметками, авторизация, поиск, офлайн‑очередь и синхронизация, форматы данных.

2) **Mobile‑приложение (UI слой)**  
Отвечает за экранные сценарии: вход, список заметок, открытие заметки, редактирование, поиск, настройки.

3) **Платформенный слой (адаптеры)**  
Это «мост» между ядром и мобильной платформой: где хранить данные на телефоне, как запускать вход через внешнее окно, как реагировать на пропадание/появление сети, как устроена навигация.

4) **Внешние сервисы**  
Облако (данные, авторизация, хранилище медиа). Ядро взаимодействует с внешними сервисами через единые сервисные операции, а мобильное приложение добавляет локальное кеширование и офлайн‑поведение.

### Что это даёт бизнесу
- **Скорость**: новые бизнес‑возможности добавляются один раз в ядро.
- **Согласованность**: поведение web и mobile должно быть одинаковым (где это важно).
- **Управляемость**: можно развивать интерфейсы независимо, не переписывая «мозги».

## Как это работает в пользовательских сценариях
Ниже — “как пользователь ощущает”, и что делает система внутри, на абстрактном уровне.

### 1) Вход в приложение
- Пользователь нажимает «Войти».
- Открывается внешний сценарий входа, после чего приложение «возвращается» обратно.
- Сессия сохраняется безопасно.
- После входа приложение загружает список заметок.

### 2) Список заметок
- По умолчанию показывается список заметок из облака.
- Параллельно данные кешируются локально на телефоне, чтобы приложение было быстрее и могло работать без сети.

### 3) Открытие и редактирование заметки
- Заголовок и метаданные — нативно в приложении.
- Тело заметки редактируется в «встроенном редакторе» (см. следующий раздел про ключевое решение).
- Изменения сохраняются автоматически через небольшую задержку (чтобы не сохранять каждую букву).

### 4) Офлайн‑режим и синхронизация
- Без сети пользователь может просматривать уже закешированные заметки.
- Действия пользователя (создать/изменить/удалить) складываются в локальную очередь.
- Когда сеть появляется, очередь автоматически “проигрывается” в облако.

### 5) Поиск
- При наличии сети может использоваться поиск на серверной стороне.
- При отсутствии сети используется локальный поиск по закешированным данным.

## Ключевое решение, которое влияет на сложность: редактор в mobile
### Что выбрано
Чтобы быстро получить богатый редактор текста в мобильном приложении, мы используем **встроенный веб‑редактор** внутри приложения.

### Почему это ускоряет MVP
- Не нужно заново реализовывать богатый редактор под мобильные платформы.
- Максимально сохраняется функциональное соответствие между web и mobile.

### Почему это делает разработку тяжелее
Это превращает mobile‑приложение в систему из двух «миров», которые должны работать вместе:
- мобильный интерфейс;
- встроенная страница редактора.

Из-за этого чаще возникают проблемы, которые на вебе не проявляются:
- зависимость от доступности страницы редактора (особенно в разработке на реальном телефоне);
- нюансы с сетью и доступом к локальным адресам;
- различия поведения на Android/iOS;
- большие заметки и медиа (картинки) требуют отдельной проработки.

## Верность решений: где всё хорошо, а где нужны решения
### Что выглядит правильным и полезным
- **Разделение на ядро и интерфейсы** — правильная ставка для продукта, который живёт на нескольких платформах.
- **Слой адаптеров** — правильный способ держать «платформенные детали» вне бизнес‑логики.
- **Локальное кеширование и офлайн‑очередь** — правильное направление для заметок (пользователь ожидает отзывчивости и доступности без сети).

### Что вызывает риски или потребует доработок
1) **Офлайн‑редактирование тела заметки**  
Если редактор зависит от внешней страницы, то полноценный офлайн‑режим для редактирования может быть ограничен. Это нужно явно согласовать как продуктовую цель.

2) **Медиа в заметках (картинки, вложения)**  
На мобильных платформах важно заранее определить стратегию: где лежат картинки, как они становятся доступными, что происходит в офлайне.

3) **Стабильность процесса разработки**  
Мобильная разработка потребует дисциплины: единых инструкций запуска, быстрых “smoke checks”, и понятного «что должно работать всегда».

4) **Дрейф документации и реальности**  
Документы архитектуры есть, но неизбежно появляются расхождения по мере развития. Это нормально, но важно регулярно обновлять описание, чтобы команда не теряла контекст.

## Рекомендации (что делать дальше)
Ниже — управленческие рекомендации в порядке приоритета.

### 1) Принять решение по стратегии редактора
Варианты:
- **Оставляем встроенный веб‑редактор** как MVP‑стратегию и инвестируем в стабилизацию (это быстрее, но требует дисциплины и аккуратной поддержки офлайна/медиа).
- **Переходим на нативный редактор** (это дороже и дольше, но снижает класс проблем “страница внутри приложения” и проще для офлайна).
- **Гибрид**: MVP на веб‑редакторе, параллельно планируем переход/альтернативу, если качество/офлайн/стабильность не достигаются.

### 2) Зафиксировать “Definition of Done” для mobile
Минимальный набор, который всегда должен быть стабилен:
- вход/выход;
- список заметок;
- открытие/редактирование заметки;
- работа с большими заметками;
- картинки в заметках;
- поведение без сети (что именно обещаем пользователю).

### 3) Стабилизировать процесс разработки
Цель — чтобы разработка ощущалась “как на вебе”: запуск предсказуемый, баги воспроизводимы, диагностика очевидна.

### 4) Запланировать этап “полировки” после MVP‑функционала
Когда функциональные блоки собраны, неизбежно нужна неделя‑две на:
- устранение классов проблем, специфичных для мобильных платформ;
- улучшение производительности на реальных устройствах;
- подготовку к публикации и процессу обновлений.

## Итоговый вердикт
**Мы не страдаем фигнёй**: выбранная архитектура в целом разумная и соответствует цели переиспользования ядра между web и mobile.  
При этом **основной источник боли — подход к редактору** и типичные мобильные ограничения. Если заранее принять решение по стратегии редактора и стабилизировать процесс разработки, дальнейшая работа станет заметно предсказуемее.

