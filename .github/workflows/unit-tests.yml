name: Unit Tests

on:
  push:
    branches: [main, develop, github-actions-setup]
  pull_request:
  workflow_dispatch:

permissions:
  actions: read
  contents: read

jobs:
  unit-tests:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install root dependencies
        run: npm ci

      - name: Install mobile dependencies
        run: npm --prefix ui/mobile ci

      - name: Run Jest tests
        id: unit-tests
        run: npm --prefix ui/mobile test -- --verbose --ci

      - name: Generate test summary
        if: always()
        run: |
          echo "## ðŸ§ª Unit Test Results" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "${{ steps.unit-tests.outcome }}" == "success" ]; then
            echo "âœ… **Status:** All tests passed" >> $GITHUB_STEP_SUMMARY
          else
            echo "âŒ **Status:** Some tests failed" >> $GITHUB_STEP_SUMMARY
          fi
