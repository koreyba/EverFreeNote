---
description: when creating DB migrations
alwaysApply: false
---
При создании миграций базы данных, убедись, что они **безопасны и идемпотентны**.
Это значит:

* Миграция не должна ломать существующую схему или данные — только добавлять или изменять безопасно.
* Её можно запустить повторно без ошибок и дублирования.
* Используй `IF NOT EXISTS`, проверки перед изменениями, пошаговый подход: **сначала добавить новое (expand)** → **перенести данные (migrate)** → **удалить старое (contract)**.
* Избегай блокирующих операций и потери данных.
* Убедись, что при необходимости миграцию можно откатить.
